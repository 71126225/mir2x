version: 'build-{build}'

image: Visual Studio 2017

platform: x64

environemnt:
    ENVDEF_CMAKE_GENERATOR: -G"Visual Studio 15 2017 Win64"
    ENVDEF_CMAKE_GENERATOR_PLATFORM: -DCMAKE_GENERATOR_PLATFORM=x64
    ENVDEF_CMAKE_TOOLCHAIN_FILE: -DCMAKE_TOOLCHAIN_FILE="C:\Tools\vcpkg\scripts\buildsystems\vcpkg.cmake"
    ENVDEF_CMAKE_TARGET_TRIPLET: -DCMAKE_TARGET_TRIPLET=x64-windows
    VCPKG_DEFAULT_TRIPLET: x64-windows
 
configuration:
  - Release

install:
    - cmd: |-
        vcpkg install lua
        vcpkg install sdl2

before_build:
    - cmd: |-
        mkdir build
        cd build
        cmake --version
        cmake .. %ENVDEF_CMAKE_GENERATOR% %ENVDEF_CMAKE_GENERATOR_PLATFORM% %ENVDEF_CMAKE_TOOLCHAIN_FILE% %ENVDEF_CMAKE_TARGET_TRIPLET%
        cmake --build . --target package --config Release

build_script:
    - echo "Done"

after_build:
    - echo "Done"

test_script:
    - echo "Done"

artifacts:
    - path: build\*.zip

deploy:
    provider: GitHub
    auth_token:
        secure: HHPH5otHDTeP2iU11PdRWnhpOMycDJ/n+NKC0xvSphvA4NLz41/rASWc1UseTQgU
    on:
        APPVEYOR_REPO_TAG: true
